var PUZZLE=PUZZLE||{};PUZZLE.PuzzleEntity=function(h,d,e,c,f,b,a,g){return{TileWidth:h,TileHeight:d,Tiles:e,RowTileCount:c,ColTileCount:f,Positions:b,InitialPosition:a,EmptyPositionRandom:a,Gap:g}};var PUZZLE=PUZZLE||{};PUZZLE.logic=PUZZLE.logic||{};PUZZLE.logic.GetTileWidth=function(b,a){var c=parseInt(b/a,10);return c};PUZZLE.logic.GetXTilesCount=function(b,c){var a=parseInt(b/c,10);return a};PUZZLE.logic.GetTileHeight=function(b,a){var c=parseInt(b/a,10);return c};PUZZLE.logic.GetYTilesCount=function(a,b){var c=parseInt(a/b,10);return c};PUZZLE.logic.GetTileArrays=function(b,d,f){var e=0,c=[],a=[],g=0,h=0;for(g=0;g<d;g+=1){for(h=0;h<b;h+=1){if(e===f){c[e]=new PUZZLE.TileEntity(h,g,e);a.push(e);e+=1;a.push(e);h+=1}else{a.push(e)}c[e]=new PUZZLE.TileEntity(h,g,e);e+=1}}return{PositionArray:a,PointerArray:c}};PUZZLE.logic.GoLeft=function(a){var c,b;c=a.Positions[a.EmptyPositionRandom+1];b=a.Positions[a.EmptyPositionRandom];a.Positions[a.EmptyPositionRandom+1]=b;a.Positions[a.EmptyPositionRandom]=c;a.EmptyPositionRandom+=1;return c};PUZZLE.logic.GoRight=function(a){var b,c;b=a.Positions[a.EmptyPositionRandom-1];c=a.Positions[a.EmptyPositionRandom];a.Positions[a.EmptyPositionRandom-1]=c;a.Positions[a.EmptyPositionRandom]=b;a.EmptyPositionRandom-=1;return b};PUZZLE.logic.GoDown=function(a){var b,c;b=a.Positions[a.EmptyPositionRandom-a.RowTileCount];c=a.Positions[a.EmptyPositionRandom];a.Positions[a.EmptyPositionRandom-a.RowTileCount]=c;a.Positions[a.EmptyPositionRandom]=b;a.EmptyPositionRandom-=a.RowTileCount;return b};PUZZLE.logic.GoUp=function(a){var b,c;b=a.Positions[a.EmptyPositionRandom+a.RowTileCount];c=a.Positions[a.EmptyPositionRandom];a.Positions[a.EmptyPositionRandom+a.RowTileCount]=c;a.Positions[a.EmptyPositionRandom]=b;a.EmptyPositionRandom+=a.RowTileCount;return b};PUZZLE.logic.GetRandomList=function(d){var c,b=[],a=0;for(a=0;a<d;a+=1){c=Math.floor((Math.random()*4)+1);b.push(c)}return b};PUZZLE.logic.Randomize=function(e,n){var g=e.Positions,h,l,m,d,c,f=0,a,k,b,j,o;d=e.RowTileCount*e.ColTileCount;for(f=0;f<n.length;f+=1){l=n[f];switch(l){case 1:if(((e.EmptyPositionRandom+1)%e.RowTileCount)!==0){a=e.Tiles[e.InitialPosition];a.FrontPositionX=a.FrontPositionX+1;k=e.Positions[e.EmptyPositionRandom+1];b=e.Tiles[k];b.FrontPositionX=b.FrontPositionX-1;m=PUZZLE.logic.GoLeft(e)}break;case 2:if(((e.EmptyPositionRandom+1)%e.RowTileCount)!==1){a=e.Tiles[e.InitialPosition];a.FrontPositionX=a.FrontPositionX-1;j=e.Positions[e.EmptyPositionRandom-1];o=e.Tiles[j];o.FrontPositionX=o.FrontPositionX+1;m=PUZZLE.logic.GoRight(e)}break;case 3:if(e.EmptyPositionRandom>=e.RowTileCount){a=e.Tiles[e.InitialPosition];a.FrontPositionY=a.FrontPositionY-1;k=e.Positions[e.EmptyPositionRandom-e.RowTileCount];b=e.Tiles[k];b.FrontPositionY=b.FrontPositionY+1;m=PUZZLE.logic.GoDown(e)}break;case 4:if(e.EmptyPositionRandom<(d-e.RowTileCount)){a=e.Tiles[e.InitialPosition];a.FrontPositionY=a.FrontPositionY+1;j=e.Positions[e.EmptyPositionRandom+e.RowTileCount];o=e.Tiles[j];o.FrontPositionY=o.FrontPositionY-1;m=PUZZLE.logic.GoUp(e)}break}}};PUZZLE.logic.DomCreation=function(b,p,d){var k,q,l,m,o,a,g,f,e,j,h,n,c;k=document.createElement("div");k.setAttribute("class","tilewrapper");q=document.createElement("div");q.setAttribute("class","position");for(f=0;f<d.Tiles.length;f+=1){m=d.Tiles[f];if(f!==d.InitialPosition){a=PUZZLE.logic.IdName(f,d);o=PUZZLE.logic.GetTileCssEntity(m,d,"tile tileimage shadow border");l=PUZZLE.logic.GenerateTileAttributes(o,a,false,true);q.appendChild(l)}}g=d.Positions[d.EmptyPositionRandom];m=d.Tiles[g];e=m.FrontPositionX;j=m.FrontPositionX-1;h=m.FrontPositionX+1;n=m.FrontPositionY+1;c=m.FrontPositionY-1;m.FrontPositionX=j;o=PUZZLE.logic.GetTileCssEntity(m,d,"tile border shadow transparentTile");l=PUZZLE.logic.GenerateTileAttributes(o,"rightArrow",true,false);q.appendChild(l);m.FrontPositionX=h;o=PUZZLE.logic.GetTileCssEntity(m,d,"tile border shadow transparentTile");l=PUZZLE.logic.GenerateTileAttributes(o,"leftArrow",true,false);q.appendChild(l);m.FrontPositionX=e;m.FrontPositionY=n;o=PUZZLE.logic.GetTileCssEntity(m,d,"tile border shadow transparentTile");l=PUZZLE.logic.GenerateTileAttributes(o,"upArrow",true,false);q.appendChild(l);m.FrontPositionX=e;m.FrontPositionY=c;o=PUZZLE.logic.GetTileCssEntity(m,d,"tile border shadow transparentTile");l=PUZZLE.logic.GenerateTileAttributes(o,"downArrow",true,false);q.appendChild(l);k.appendChild(q);return k};PUZZLE.logic.GetTileCssEntity=function(e,c,d){var b,f,a,i,g,h;b=PUZZLE.logic.PositionXStyle(e,c);f=PUZZLE.logic.PositionYStyle(e,c);a=PUZZLE.logic.TileSizeStyleX(c);i=PUZZLE.logic.TileSizeStyleY(c);g=PUZZLE.logic.BackGroundPos(e,c);h=new PUZZLE.TileCssEntity(b,f,a,i,g,d);return h};PUZZLE.logic.GenerateTileAttributes=function(f,e,d,b){var a=document.createElement("div"),c;a.setAttribute("class",f.ClassesName);c="left:"+f.Left+";top:"+f.Top+";width:"+f.Width+";height:"+f.Height+";background-position:"+f.BackgroundPosition+";";if(d===true){c+="z-index: 1;"}if(b===false){c+="display: none;"}a.setAttribute("style",c);if(e!==null){a.setAttribute("id",e)}return a};PUZZLE.logic.ClicDroit=function(c){var a,b,d;a=c.data.puzzleEntity;b=PUZZLE.logic.GoRight(a);d=$("#rightArrow, #leftArrow, #upArrow, #downArrow");$.when(d.fadeOut(125)).then(function(){var e=$("#TILE_"+b);e.animate({left:"+="+parseInt(a.TileWidth+a.Gap,10)},250,function(){d.animate({left:"-="+parseInt(a.TileWidth+a.Gap,10)},125);PUZZLE.logic.ShowHideArrow(a,d)})})};PUZZLE.logic.ClicGauche=function(c){var b,e,d,a;b=c.data.puzzleEntity;e=PUZZLE.logic.GoLeft(b);d=$("#rightArrow, #leftArrow, #upArrow, #downArrow");$.when(d.fadeOut(125)).then(function(){a=$("#TILE_"+e);a.animate({left:"-="+parseInt(b.TileWidth+b.Gap,10)},250,function(){d.animate({left:"+="+parseInt(b.TileWidth+b.Gap,10)},125);PUZZLE.logic.ShowHideArrow(b,d)})})};PUZZLE.logic.ClicDown=function(d){var b,c,e,a;b=d.data.puzzleEntity;c=PUZZLE.logic.GoDown(b);e=$("#rightArrow, #leftArrow, #upArrow, #downArrow");$.when(e.fadeOut(125)).then(function(){a=$("#TILE_"+c);a.animate({top:"+="+parseInt(b.TileHeight+b.Gap,10)},250,function(){e.animate({top:"-="+parseInt(b.TileHeight+b.Gap,10)},125);PUZZLE.logic.ShowHideArrow(b,e)})})};PUZZLE.logic.ClicUp=function(d){var b,c,e,a;b=d.data.puzzleEntity;c=PUZZLE.logic.GoUp(b);e=$("#rightArrow, #leftArrow, #upArrow, #downArrow");$.when(e.fadeOut(125)).then(function(){a=$("#TILE_"+c);a.animate({top:"-="+parseInt(b.TileHeight+b.Gap,10)},250,function(){e.animate({top:"+="+parseInt(b.TileHeight+b.Gap,10)},125);PUZZLE.logic.ShowHideArrow(b,e)})})};PUZZLE.logic.ShowHideArrow=function(d,b){var a,e,g,f,c;a=d.Positions[d.EmptyPositionRandom+1];e=d.Positions[d.EmptyPositionRandom-1];g=d.Positions[d.EmptyPositionRandom+d.RowTileCount];f=d.Positions[d.EmptyPositionRandom-d.RowTileCount];if(((d.EmptyPositionRandom+1)%d.RowTileCount)===0){b=b.filter("#rightArrow, #upArrow, #downArrow")}if(((d.EmptyPositionRandom+1)%d.RowTileCount)===1){b=b.filter("#leftArrow, #upArrow, #downArrow")}c=d.RowTileCount*d.ColTileCount;if(d.EmptyPositionRandom>=(c-d.RowTileCount)){b=b.filter("#rightArrow, #leftArrow, #downArrow")}if(d.EmptyPositionRandom<d.RowTileCount){b=b.filter("#rightArrow, #leftArrow, #upArrow")}b.fadeIn(150)};PUZZLE.logic.Collapse=function(a){var e,q,h,m,d,f,o,p,b,l,r,n,g,j,c,k;e=a.data.puzzleEntity;q=e.Tiles;h=e.Positions;p=$("#rightArrow, #leftArrow, #upArrow, #downArrow");r=e;p.fadeOut(250);for(g=0;g<=q.length;g+=1){j=h[g];n=$("#TILE_"+j);n.removeClass("redTile");if(g!==j){n.addClass("redTile")}if(j!==-1){m=q[j];d=$("#TILE_"+j);b=parseInt(g%r.RowTileCount,10);l=parseInt(g/r.RowTileCount,10);o=parseInt(b*r.TileWidth,10)+"px";c=parseInt(l*r.TileHeight,10)+"px";d.animate({left:o,top:c},750)}}k=$(".tile");k.removeClass("shadow",750)};PUZZLE.logic.Expand=function(n){var a,p,e,r,m,q,d,b,c,l,o,s,k,j,g,f;a=n.data.puzzleEntity;p=a.Tiles;e=a.Positions;b=$("#rightArrow, #leftArrow, #upArrow, #downArrow");f=function h(){PUZZLE.logic.ShowHideArrow(a,b)};for(o=0;o<=p.length;o+=1){s=e[o];k=$("#TILE_"+s);k.removeClass("redTile");if(s!==-1){r=p[s];m=$("#TILE_"+s);c=parseInt(o%a.RowTileCount,10);l=parseInt(o/a.RowTileCount,10);d=parseInt(c*a.TileWidth+a.Gap*c,10)+"px";j=parseInt(l*a.TileHeight+a.Gap*l,10)+"px";m.animate({left:d,top:j},750,f)}}g=$("[id*=TILE_], .transparentTile");g.addClass("shadow",250)};PUZZLE.logic.BindArrowClick=function(a){$("#rightArrow").bind("click",{puzzleEntity:a},PUZZLE.logic.ClicDroit);$("#leftArrow").bind("click",{puzzleEntity:a},PUZZLE.logic.ClicGauche);$("#upArrow").bind("click",{puzzleEntity:a},PUZZLE.logic.ClicUp);$("#downArrow").bind("click",{puzzleEntity:a},PUZZLE.logic.ClicDown);$("#hideErrorsBtn").bind("click",{puzzleEntity:a},PUZZLE.logic.Expand);$("#showErrorsBtn").bind("click",{puzzleEntity:a},PUZZLE.logic.Collapse)};PUZZLE.logic.RightArrowVisible=function(b,c){var a;if(b===(c.Positions[c.EmptyPositionRandom-1])){a=true}else{a=false}return a};PUZZLE.logic.LeftArrowVisible=function(b,c){var a;if(b===(c.Positions[c.EmptyPositionRandom+1])){a=true}else{a=false}return a};PUZZLE.logic.DownArrowVisible=function(b,c){var a;if(b===(c.Positions[c.EmptyPositionRandom-c.RowTileCount])){a=true}else{a=false}return a};PUZZLE.logic.UpArrowVisible=function(b,c){var a;if(b===(c.Positions[c.EmptyPositionRandom+c.RowTileCount])){a=true}else{a=false}return a};PUZZLE.logic.PositionX=function(b,a){return(b.FrontPositionX*a.TileWidth+a.Gap*b.FrontPositionX)};PUZZLE.logic.PositionXStyle=function(b,a){return(this.PositionX(b,a)+"px")};PUZZLE.logic.PositionY=function(b,a){return(b.FrontPositionY*a.TileHeight+a.Gap*b.FrontPositionY)};PUZZLE.logic.PositionYStyle=function(b,a){return(this.PositionY(b,a)+"px")};PUZZLE.logic.IdName=function(a,b){return("TILE_"+a)};PUZZLE.logic.TileSizeStyleX=function(a){return(a.TileWidth+"px")};PUZZLE.logic.TileSizeStyleY=function(a){return(a.TileHeight+"px")};PUZZLE.logic.BackGroundPos=function(b,a){return(((b.BackPositionX*a.TileWidth)*-1)+"px "+(b.BackPositionY*a.TileHeight*-1)+"px")};PUZZLE.logic.InitPuzzle=function(a,o,e,k,n){var l,h,i,c,d,b,g,p,f,j,m,q;l=PUZZLE.logic.GetTileWidth(a,e);h=PUZZLE.logic.GetTileHeight(o,e);i=PUZZLE.logic.GetXTilesCount(a,l);c=PUZZLE.logic.GetYTilesCount(o,h);d=parseInt(i/2,10)+parseInt((c/2)*i,10);b=PUZZLE.logic.GetTileArrays(i,c,d);g=PUZZLE.PuzzleEntity(l,h,b.PointerArray,i,c,b.PositionArray,d,k);p=PUZZLE.logic.GetRandomList(20);PUZZLE.logic.Randomize(g,p);f=PUZZLE.logic.DomCreation(a,o,g);j=document.getElementById(n);if(j!==undefined){j.appendChild(f);m=$("#rightArrow, #leftArrow, #upArrow, #downArrow");PUZZLE.logic.ShowHideArrow(g,m);PUZZLE.logic.BindArrowClick(g);q=g}else{q=null}};var PUZZLE=PUZZLE||{};PUZZLE.TileCssEntity=function(f,e,d,a,c,b){return{Left:f,Top:e,Width:d,Height:a,BackgroundPosition:c,ClassesName:b}};var PUZZLE=PUZZLE||{};PUZZLE.TileEntity=function(c,b,a){return{BackPositionX:c,BackPositionY:b,Position:a,FrontPositionX:c,FrontPositionY:b}};